# remap prefix from 'C-b' to 'C-a'
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Set new panes to open in current directory
bind c new-window -c "#{pane_current_path}"

# split panes using | and =
bind - split-window -h -c "#{pane_current_path}"
bind = split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

set -gq allow-passthrough on

# reload config file
bind r source-file ~/.tmux.conf

bind o  if -F '#{window_zoomed_flag}' 'resize-pane -Z; select-pane -t :.+; resize-pane -Z' 'select-pane -t :.+'
bind O  if -F '#{window_zoomed_flag}' 'resize-pane -Z; select-pane -t :.-; resize-pane -Z' 'select-pane -t :.-'

bind S command-prompt -p "New Session:" "new-session -A -s '%%'"
bind K confirm kill-session

# Better window/pane management
bind X confirm-before -p "Kill window #W? (y/n)" kill-window
bind x confirm-before -p "Kill pane #P? (y/n)" kill-pane

# Quick pane layouts
bind M-1 select-layout even-horizontal
bind M-2 select-layout even-vertical
bind M-3 select-layout main-horizontal
bind M-4 select-layout main-vertical
bind M-5 select-layout tiled

bind -r H resize-pane -L 3
bind -r J resize-pane -D 3
bind -r K resize-pane -U 3
bind -r L resize-pane -R 3

# Switch panes with ctrl+hjkl
bind -n C-h select-pane -L
bind -n C-j select-pane -D
bind -n C-k select-pane -U
bind -n C-l select-pane -R

# Easier and faster switching between next/prev window
bind C-p previous-window
bind C-n next-window

# Swap windows
bind -r "<" swap-window -d -t -1
bind -r ">" swap-window -d -t +1

set -g pane-base-index 1
set -g base-index 1              # start indexing windows at 1 instead of 0
set -g detach-on-destroy off     # don't exit from tmux when closing a session
set -g escape-time 0             # zero-out escape time delay
set -g history-limit 1000000     # increase history size (from 2,000)
set -g renumber-windows on       # renumber all windows when any window is closed
set -g set-clipboard on          # use system clipboard
set -g status-interval 3         # update status every 3 seconds
set -g display-time 2000         # display messages for 2 seconds
set -g aggressive-resize on      # resize window to smallest client viewing it

# Enable mouse mode
set -g mouse on

# Mouse behavior improvements
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'copy-mode -e'"
bind -n MouseDrag1Pane if -Ft= '#{mouse_any_flag}' 'if -Ft= "#{pane_in_mode}" "copy-mode -M" "send-keys -M"' 'copy-mode -M'

# loud or quiet?
set -g visual-activity off
set -g visual-bell off
set -g visual-silence off
setw -g monitor-activity off
set -g bell-action none

# Neovim recommendations
set-option -g focus-events on

# Undercurl support for modern terminals
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

# act like vim
setw -g mode-keys vi

# Modern vi-mode copy bindings
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi Escape send-keys -X cancel
bind -T copy-mode-vi H send-keys -X start-of-line
bind -T copy-mode-vi L send-keys -X end-of-line

# Color support
set -g update-environment "DISPLAY SSH_ASKPASS SSH_AUTH_SOCK SSH_AGENT_PID SSH_CONNECTION COLORTERM"
set-environment -g COLORTERM truecolor
set -g default-terminal "tmux-256color"
set -as terminal-overrides ",*:Tc"

######################
### STATUS BAR ###
######################

# Status bar at top
set -g status-position top
set -g status-style "bg=default,fg=default"
set -g status-justify left

# Status left: prefix indicator only
set -g status-left-length 10
set -g status-left "#{?client_prefix,#[reverse]#[bold] ^ #[noreverse]#[none],}"

# Status right: session name, current path, and zoom indicator
set -g status-right-length 60
set -g status-right "#{?window_zoomed_flag, Z #{pane_index}/#{window_panes} ,}#{=/-20/...:#{b:pane_current_path}}  #S "

# Window status format
set -g window-status-format " #I:#W "
set -g window-status-style "bg=default,fg=default,none"
set -g window-status-current-format " #I:#W "
set -g window-status-current-style "bg=default,fg=default,reverse,bold"
set -gF window-status-separator ""

# Pane border
setw -g pane-border-status off
setw -g pane-active-border-style "fg=default"
setw -g pane-border-style "fg=default,dim"

# Mode style (copy mode)
set -g mode-style "bg=default,fg=default,reverse"
